<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> TableViewCell的收缩展开与动态高度 · partyspy的技术博客</title><meta name="description" content="TableViewCell的收缩展开与动态高度 - partyspy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/partyspy.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/partyspy.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/partyspy" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/partyspy" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">TableViewCell的收缩展开与动态高度</h1><div class="post-info">Jun 14, 2016</div><div class="post-content"><blockquote>
<p>关于TableViewCell的收缩展开与动态高度的方法网上有很多，但本文主要运用AutoLayout和更改<strong>Constraint priority</strong>的方式来实现，另外包括了StackView动态插入在TableViewCell里的运用。</p>
</blockquote>
<a id="more"></a>
<h3 id="Cell收缩与展开"><a href="#Cell收缩与展开" class="headerlink" title="Cell收缩与展开"></a>Cell收缩与展开</h3><p>这是在实际项目中遇到一个需求。展示一个表格，每一行为一个项目的汇总行，点击表格每一行时展开一系列细节小行，在此点击收起该行，仅展示汇总行。如下图所示。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2252015-78fd57325df4b9e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><img src="http://upload-images.jianshu.io/upload_images/2252015-e0f764e66b54fbe1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><img src="http://upload-images.jianshu.io/upload_images/2252015-325f154eac08d5c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<blockquote>
<p>我们用TableView去实现该需求。在点击cell时展开该cell, 再次点击时收起。不同的cell展开高度依赖于该cell所展示的内容。每一个行用StackView去实现。这里将用到嵌套的StackView和StackView动态插入。另外我用了设置约束优先级去解决Cell内容显示错位的问题。</p>
</blockquote>
<p>我们先实现Cell的展开与收缩。</p>
<ul>
<li><p>定义一个Dictionary来存储每个Cell的展开或收缩状态。<strong>key</strong>为<em>IndexPath</em>。- </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy) NSMutableDictionary *expandedFlagOfRowDict;</span><br></pre></td></tr></table></figure>
</li>
<li><p>每次选择cell后toggle展开状态。实现TableView delegate方法。</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    </span><br><span class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</span><br><span class="line">    </span><br><span class="line">    BMMerchantCell *cell = [tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//toggle the expanded flag</span></span><br><span class="line">    <span class="keyword">self</span>.expandedFlagOfRowDict[indexPath] = [<span class="built_in">NSNumber</span> numberWithBool:![<span class="keyword">self</span>.expandedFlagOfRowDict[indexPath] boolValue]];;</span><br><span class="line">           </span><br><span class="line">    [tableView beginUpdates];</span><br><span class="line">    [tableView endUpdates];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>调用<em>-beginUpdates</em> 后 tableView delegate会回调 <em>heightForRowAtIndexPath</em>方法。<blockquote>
<p><em>-beginUpdates</em> 和 <em>-endUpdates</em> 必须组合使用。</p>
</blockquote>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//cell expanded height</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.expandedFlagOfRowDict[indexPath] boolValue]) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">self</span>.heightForRowDict[indexPath] floatValue];</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">//cell collapsed height</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">44</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>由此实现了Cell的展开与收缩。</li>
</ul>
<h3 id="Cell动态高度"><a href="#Cell动态高度" class="headerlink" title="Cell动态高度"></a>Cell动态高度</h3><p>上面代码我们留意到有 <em>self.heightForRowDict</em> 这玩意儿，每个row展开的高度是不一样的。它与<em>self.expandedFlagOfRowDict</em> 类似，我们定义一个字典来存储每一个Cell的高度。该字典Key为IndexPath，value为高度。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableDictionary</span> *heightForRowDict;</span><br></pre></td></tr></table></figure></p>
<p>而每个Cell的高度由Cell对象本身确定。我们用IB去定义Cell原型。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2252015-a37d6770d385ab00.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>Cell收缩状态时，仅展示汇总一行（即<em>Sum Stack View</em>)。点击展开时，显示细节行，细节行数不定。细节行嵌套到<em>Detail Stack View</em>这个大的StackView中。</p>
<p><em>细节行：（称之为DetailItemStackView)</em><br><img src="http://upload-images.jianshu.io/upload_images/2252015-439f15ae2ab7faa1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>可见，在SumStackView高度已定，DetailStackView设定top与bottom约束，DetailItemStackView高度已定情况下，Cell的高度就由细节行的插入的多少决定了。</p>
<blockquote>
<p><strong>Note：</strong>与Label、Button等控件一样，Stack View 也有自己的Intrinsic Size，在未设定约束时亦能确定自己的大小。其依赖于内部subView的大小和space。在subView约束未定时其本身大小同依据于本身Intrinsic Size确定。这是一个嵌套递归的过程。</p>
</blockquote>
<p>接下来就计算TableView Cell的高度。</p>
<ul>
<li>在收缩状态时，其高度等于<em>SumStackView</em>的高度。</li>
<li>在展开状态时，其高度等于<em>SumStackView</em>和<em>DetailStackView</em>高度加两者距离加<em>DetailStackView</em>与<em>Cell.Bottom</em>距离。</li>
</ul>
<p>考虑到解耦与<strong>性能优化</strong>问题，Cell的高度与内容将不在Controller层计算。<em>-tableView:heightForRowAtIndexPath:</em> 中仅负责读取高度值。<br>自定义Cell对象：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyCell.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyCell</span> : <span class="title">UITableViewCell</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIStackView</span> *detailStackView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIStackView</span> *sumStackView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *cityLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *sumLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *vLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> rowHeight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>先把cell的高度都设为定值，运行看看收缩与展开效果，假定<em>rowHeight=100</em>;<br><img src="http://upload-images.jianshu.io/upload_images/2252015-4cf937942f0a1241.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>运行时可见编译器报了一大堆约束冲突警告，界面Cell内容显示位置偏离，而IB界面设计并无约束警告。经过本人探究后发现，实际上是与运行时的 <em>-tableView:heightForRowAtIndexPath:</em> 代理方法返回的高度相冲突。该高度H !== sumStackView.height + <em>space</em> + detailStackView.height + <em>space</em>; 故而冲突。而将其中一个<em>space</em>的约束优先级调低至750，冲突解决。界面显示正常。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2252015-af158e6b724ff3bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<blockquote>
<p><strong>Note：</strong>由此得知，<em>-tableView:heightForRowAtIndexPath:</em> 返回高度值的约束优先级实际上是介于<strong>750</strong>和<strong>1000</strong>之间的<strong>（750&lt;p&lt;1000）</strong>。</p>
</blockquote>
<h5 id="Cell与StackView"><a href="#Cell与StackView" class="headerlink" title="Cell与StackView"></a>Cell与StackView</h5><p>至此Cell展开后显示的是一个空的StackView，现在我们往Cell类里添加两个方法内容。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyCell.m</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Cell collapsed content</span></span><br><span class="line">- (<span class="keyword">void</span>)loadSumLineByDict:(<span class="built_in">NSDictionary</span> *)dataDict &#123;</span><br><span class="line">    <span class="keyword">self</span>.cityLabel.text = dataDict[<span class="string">@"cityDes"</span>];</span><br><span class="line">    <span class="keyword">self</span>.sumLabel.text = [(<span class="built_in">NSNumber</span> *)dataDict[<span class="string">@"sum"</span>] stringValue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Cell expanded content</span></span><br><span class="line">- (<span class="keyword">void</span>)loadDetailLinesByDict:(<span class="built_in">NSDictionary</span> *)dataDict &#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *detailList = (<span class="built_in">NSArray</span> *)dataDict[<span class="string">@"detail"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Insert sub stackViews. Performance consuming process.</span></span><br><span class="line">    [detailList enumerateObjectsUsingBlock:^(<span class="keyword">id</span>  _Nonnull obj, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *mccTag = [(<span class="built_in">NSDictionary</span> *)obj objectForKey:<span class="string">@"mccTag"</span>];</span><br><span class="line">        <span class="built_in">NSNumber</span> *num = [(<span class="built_in">NSDictionary</span> *)obj objectForKey:<span class="string">@"num"</span>];</span><br><span class="line">        DetailItemStackView *itemSV = [[[<span class="built_in">NSBundle</span> mainBundle] loadNibNamed:<span class="string">@"DetailItemStackView"</span> owner:<span class="literal">nil</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">        itemSV.mccTagLabel.text = mccTag;</span><br><span class="line">        itemSV.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>, num];</span><br><span class="line">        [<span class="keyword">self</span>.detailStackView addArrangedSubview:itemSV];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.detailStackView layoutIfNeeded];</span><br><span class="line">    [<span class="keyword">self</span> layoutIfNeeded];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Calculate the cell's height based on AutoLayout</span></span><br><span class="line">    <span class="built_in">CGSize</span> size = [<span class="keyword">self</span>.contentView systemLayoutSizeFittingSize:<span class="built_in">UILayoutFittingCompressedSize</span>];</span><br><span class="line">    <span class="keyword">self</span>.rowHeight = size.height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>参数<code>dataDict</code>为数据模型；</li>
<li><code>-loadSumLineByDict:</code>加载汇总行，即Cell收缩状态时的展示行；</li>
<li><code>-loadDetailLinesByDict:</code>加载细节行，即Cell展开时展示的内容；该方法设计遍历以及创建StackView对象，为耗性能的步骤。这个我们让它有生之年只Run一次就够了。</li>
<li><code>-layoutIfNeeded</code>在stackView们都插入完毕后，更新布局。实现Runtime时的Autolayout；</li>
<li><code>-systemLayoutSizeFittingSize:</code>方法返回满足约束的大小，用以获取Cell增加内容后的高度值。</li>
</ul>
<p>由此获取cell的datasource方法如下：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *cellID = <span class="string">@"MyCellID"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//load the collpased content</span></span><br><span class="line">    [cell loadSumLineByDict:<span class="keyword">self</span>.dataList[indexPath.row]];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>-cellForRow:</code>方法为高频调用，因此此处尽量进行轻量级的数据加载。此处仅加载Cell收缩状态的内容，而展开的内容则在select时加载。didSelectRow方法就变成了这样：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    </span><br><span class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</span><br><span class="line">    </span><br><span class="line">    MyCell *cell = [tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Check if the row had been loaded. If not,</span></span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.loadedFlagOfRowDict[indexPath] boolValue]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Load detail lines and calculate the height for row</span></span><br><span class="line">        [cell loadDetailLinesByDict:<span class="keyword">self</span>.dataList[indexPath.row]];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//store the height</span></span><br><span class="line">        <span class="keyword">self</span>.heightForRowDict[indexPath] = @(cell.rowHeight + <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//set the loaded flag to true and it will end up true ever since</span></span><br><span class="line">        <span class="keyword">self</span>.loadedFlagOfRowDict[indexPath] = @YES;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//toggle the expanded flag</span></span><br><span class="line">    <span class="keyword">self</span>.expandedFlagOfRowDict[indexPath] = [<span class="built_in">NSNumber</span> numberWithBool:![<span class="keyword">self</span>.expandedFlagOfRowDict[indexPath] boolValue]];;</span><br><span class="line">    </span><br><span class="line">    [tableView beginUpdates];</span><br><span class="line">    [tableView endUpdates];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>此处加入了一个字典属性来存储是否加载的标志位<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, copy) NSMutableDictionary *loadedFlagOfRowDict;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>依此判断使得该Cell展开内容有生之年仅加载一次。</p>
<ul>
<li>加载完内容后计算高度，并存储至<code>_heightForRowDict</code>中，在<code>-tableView:heightForRowAtIndexPath:</code>中读取并展示实际高度。由此实现了<em>TableViewCell</em> 的收缩展开与动态高度。</li>
</ul>
<h5 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h5><ul>
<li><code>-beginUpdates</code> &amp; <code>-endUpdates</code> 实现select Cell时收缩与展开。</li>
<li><code>-tableView:heightForRowAtIndexPath:</code> 的约束优先级。</li>
<li><code>-tableView:cellForRowAtIndexPath:</code>与<code>-tableView:heightForRowAtIndexPath:</code>为高频调用方法，高耗能的操作尽量转移到其它方法中，本例子中如Cell高度计算，内容加载等。本例中cellForRow方法仅加载cell最基本的内容。</li>
</ul>
<p><a href="http://0.0.0.0:4000/2016/06/14/tableView%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" target="_blank" rel="external">下一篇</a>讲延续本篇内容，探讨TableView的性能优化方面的问题。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/06/14/tableView性能优化/" class="prev">PREV</a><a href="/2016/06/08/hello-world/" class="next">NEXT</a></div><div data-thread-key="2016/06/14/TableViewCell的收缩展开与动态高度/" data-title="TableViewCell的收缩展开与动态高度" data-url="http://yoursite.com/2016/06/14/TableViewCell的收缩展开与动态高度/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"partyspy"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://yoursite.com">partyspy</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>